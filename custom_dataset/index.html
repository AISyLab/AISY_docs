<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Custom Dataset - AISY Framework v0.2</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Custom Dataset";
    var mkdocs_page_input_path = "custom_dataset.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> AISY Framework v0.2</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../concepts/">Concepts</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../simple_example/">Simple Example</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../datasets/">Datasets</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Custom Dataset</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#basic-h5-dataset-format">Basic h5 dataset format</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#h5py-package">h5py package</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#creating-dataset-object">Creating Dataset object</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../databases/">Databases</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../npz/">Saving to .npz files</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../neuralnetworks/">Neural Networks</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ciphers/">Ciphers</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../leakage_models/">Leakage Models</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../visualization/">Visualization</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../hyperparamatersearch/">Hyperparameter Search</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ensembles/">Ensembles</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../profiling_analyzer/">Profiling Analyzer</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../custom_loss/">Custom Loss Functions</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../custom_callbacks/">Custom Callbacks</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../custom_metrics/">Custom Early Stopping Metrics</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../data_augmentation/">Data Augmentation</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../generating_scripts/">Automatically Generating Scripts</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../errors/">Errors</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../feature_request/">Feature Request</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">AISY Framework v0.2</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Custom Dataset</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="custom-datasets">Custom datasets</h1>
<h2 id="basic-h5-dataset-format">Basic h5 dataset format</h2>
<p>The main <strong>Aisy</strong> class framework only supports datasets in .h5 format for the current version. 
The dataset in .h5 format must be structured according to the format created by ANSSI in ASCAD database. 
The .h5 file must contain traces and metadata fields, as follows:</p>
<ul>
<li>Profiling traces: [<code>Profiling_traces/traces</code>]: 2D array containing profiling traces. The format of the array must be <em>nb_traces x
  nb_samples</em>. Here, <em>samples</em> mean the amount of data points (or features) in a trace.</li>
<li>Attack traces: [<code>Attack_traces/traces</code>]: this field should contain a 2D array with attack traces. The format of the array must be *
  nb_traces x nb_samples*.</li>
<li>Profiling Metadata: [<code>Profiling_traces/metadata</code>]: metadata contains all 2D arrays for <em>keys</em>, <em>plaintext</em> and <em>ciphertext</em>. Note that,
  depending on the leakage model plaintext or ciphertext are not necessary. If metadata contains <em>mask</em> values, they will automatically
  ignored by the main <strong>Aisy</strong> class when creating labels.</li>
<li>Attack Metadata: [<code>Attack_traces/metadata</code>]: similarly, this field contains metadata for attack set.</li>
</ul>
<p>Below, user can find an example of how to create a .h5 dataset that can be interpreted by the main <strong>Aisy</strong> class:</p>
<pre><code class="language-python">import numpy as np
import h5py

&quot;&quot;&quot; create dummy profiling traces array with 10000 traces, each one containing 100 samples &quot;&quot;&quot;
profiling_traces = np.random.rand(10000, 100)

&quot;&quot;&quot; create dummy attack traces array with 1000 traces, each one containing 100 samples &quot;&quot;&quot;
attack_traces = np.random.rand(1000, 100)

&quot;&quot;&quot; create dummy plaintexts, ciphertexts and keys for profiling set: array with 10000 rows x 16 bytes &quot;&quot;&quot;
plaintexts_profiling = np.random.randint(0, 256, (10000, 16))
ciphertexts_profiling = np.random.randint(0, 256, (10000, 16))
keys_profiling = np.random.randint(0, 256, (10000, 16))

&quot;&quot;&quot; create dummy plaintexts, ciphertexts and keys for attack set: array with 1000 rows x 16 bytes &quot;&quot;&quot;
plaintexts_attack = np.random.randint(0, 256, (1000, 16))
ciphertexts_attack = np.random.randint(0, 256, (1000, 16))
keys_attack = np.random.randint(0, 256, (1000, 16))

nb_profiling_traces = 10000
nb_attack_traces = 1000
profiling_index = [i for i in range(nb_profiling_traces)]
attack_index = [i for i in range(nb_attack_traces)]

out_file = h5py.File('new_dataset.h5', 'w')

profiling_traces_group = out_file.create_group(&quot;Profiling_traces&quot;)
attack_traces_group = out_file.create_group(&quot;Attack_traces&quot;)

&quot;&quot;&quot; create fields for profiling and attack sets &quot;&quot;&quot;
profiling_traces_group.create_dataset(name=&quot;traces&quot;, data=profiling_traces, dtype=profiling_traces.dtype)
attack_traces_group.create_dataset(name=&quot;traces&quot;, data=attack_traces, dtype=attack_traces.dtype)

&quot;&quot;&quot; create metadata fields for profiling and attack sets&quot;&quot;&quot;
metadata_type_profiling = np.dtype([(&quot;plaintext&quot;, plaintexts_profiling.dtype, (nb_profiling_traces,)),
                                    (&quot;ciphertext&quot;, ciphertexts_profiling.dtype, (nb_profiling_traces,)),
                                    (&quot;key&quot;, keys_profiling.dtype, (nb_profiling_traces,))
                                    ])
profiling_metadata = np.array([(plaintexts_profiling[n], ciphertexts_profiling[n], keys_profiling[n]) for n in
                               zip(profiling_index)], dtype=metadata_type_profiling)

metadata_type_attack = np.dtype([(&quot;plaintext&quot;, plaintexts_attack.dtype, (nb_attack_traces,)),
                                 (&quot;ciphertext&quot;, ciphertexts_attack.dtype, (nb_attack_traces,)),
                                 (&quot;key&quot;, keys_attack.dtype, (nb_attack_traces,))
                                 ])
profiling_traces_group.create_dataset(&quot;metadata&quot;, data=profiling_metadata, dtype=metadata_type_profiling)

attack_metadata = np.array([(plaintexts_attack[n], ciphertexts_attack[n], keys_attack[n]) for n in
                            zip(attack_index)], dtype=metadata_type_attack)
attack_traces_group.create_dataset(&quot;metadata&quot;, data=attack_metadata, dtype=metadata_type_attack)

out_file.flush()
out_file.close()
</code></pre>
<p>For sanity checks, the user may verify if the .h5 file contain specific field in metadata.
The next example shows how to verify if <em>ciphertext</em> field is located in profiling metadata:</p>
<pre><code class="language-python">import h5py

h5_file = h5py.File(&quot;my_dataset.h5&quot;, &quot;r&quot;)
if &quot;ciphertext&quot; in h5_file['Profiling_traces/metadata'].dtype.fields:
    print(&quot;ciphertext field is in metadata for profiling traces.&quot;)
</code></pre>
<h5 id="h5py-package">h5py package</h5>
<p>To avoid incompatibility issues, AISY framework recommends to use h5py version 2.10.0, as specified in requirements.txt file.</p>
<h2 id="creating-dataset-object">Creating <strong>Dataset</strong> object</h2>
<p>After reading a .h5 file, AISY framework automatically generates an internal <strong>Dataset</strong> object. 
This object is manipulated by the classes and functions that uses dataset information.</p>
<p>As specified in this documentation, AISY framework automatically generates dataset labels from plaintext (or ciphertexts)
and keys from .h5 metadata. However, the current version of the framework only supports labels generation for AES128-related datasets.
In case the user wants to label the dataset with an alternative concept (e.g., by taking into consideration <strong>masks</strong> available to the user),
it is possible to create a <strong>Dataset</strong> object and provided it to the main <strong>Aisy</strong> class before running the analysis. This way, 
the analysis is not restricted to AES cipher only.</p>
<p>The following code provides an example to generate a <strong>Dataset</strong> object. Note that labels are created by the 
user and passed to the <strong>my_dataset</strong> object.</p>
<pre><code class="language-python">import aisy_sca
from app import *
from custom.custom_models.neural_networks import *
from aisy_sca.datasets.Dataset import Dataset
from tensorflow.keras.utils import to_categorical
import numpy as np

&quot;&quot;&quot; set profiling, validation and attack traces&quot;&quot;&quot;
x_profiling = np.random.rand(10000, 100)
x_attack = np.random.rand(1000, 100)
x_validation = np.random.rand(1000, 100)

&quot;&quot;&quot; set profiling, validation and attack labels&quot;&quot;&quot;
y_profiling = to_categorical(np.random.randint(0, 256, 10000), num_classes=256)
y_attack = to_categorical(np.random.randint(0, 256, 1000), num_classes=256)
y_validation = to_categorical(np.random.randint(0, 256, 1000), num_classes=256)

&quot;&quot;&quot; create list of key guesses for attack and validation sets &quot;&quot;&quot;
labels_key_guess_validation_set = np.random.randint(0, 256, (256, 1000))
labels_key_guess_attack_set = np.random.randint(0, 256, (256, 1000))

&quot;&quot;&quot; create dataset object &quot;&quot;&quot;
new_dataset = Dataset(x_profiling, y_profiling, x_attack, y_attack, x_validation, y_validation)

new_dataset_dict = {
    &quot;filename&quot;: &quot;new_dataset.h5&quot;,
    &quot;key&quot;: &quot;4DFBE0F27221FE10A78D4ADC8E490469&quot;,
    &quot;first_sample&quot;: 0,
    &quot;number_of_samples&quot;: 100,
    &quot;number_of_profiling_traces&quot;: 10000,
    &quot;number_of_attack_traces&quot;: 1000
}

aisy = aisy_sca.Aisy()
aisy.set_resources_root_folder(resources_root_folder)
aisy.set_database_root_folder(databases_root_folder)
aisy.set_datasets_root_folder(datasets_root_folder)
aisy.set_database_name(&quot;database_ascad_variable.sqlite&quot;)

&quot;&quot;&quot; User must set dataset object and value of good key for GE and SR &quot;&quot;&quot;
aisy.set_classes(256)
aisy.set_good_key(224)
aisy.set_dataset(new_dataset_dict, dataset=new_dataset)
aisy.set_labels_key_guesses_attack_set(labels_key_guess_attack_set)
aisy.set_labels_key_guesses_validation_set(labels_key_guess_validation_set)

aisy.set_batch_size(400)
aisy.set_epochs(10)
aisy.add_neural_network(mlp)
aisy.run()
</code></pre>
<p>In the above example, labels (<em>y_profiling, y_validation, y_attack</em>) are generated before the method <strong>run()</strong> from main <strong>Aisy</strong> class is
called.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../databases/" class="btn btn-neutral float-right" title="Databases">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../datasets/" class="btn btn-neutral" title="Datasets"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../datasets/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../databases/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
